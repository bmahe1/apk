version: 0.2

phases:
  install:
    runtime-versions:
      java: 17
    commands:
      - echo "Installing Android SDK..."
      - wget https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip -O cmdline-tools.zip
      - mkdir -p $HOME/android-sdk/cmdline-tools
      - unzip -q cmdline-tools.zip -d $HOME/android-sdk/cmdline-tools
      - mv $HOME/android-sdk/cmdline-tools/cmdline-tools $HOME/android-sdk/cmdline-tools/latest
      - export ANDROID_HOME=$HOME/android-sdk
      - export PATH=$ANDROID_HOME/cmdline-tools/latest/bin:$PATH
      - export PATH=$ANDROID_HOME/platform-tools:$PATH
      - yes | sdkmanager --licenses
      - sdkmanager "platform-tools" "platforms;android-34" "build-tools;34.0.0"

  build:
    commands:
      - echo "Building APK..."
      - chmod +x gradlew
      - ./gradlew assembleRelease

artifacts:
  files:
    - app/build/outputs/apk/release/app-release.apk
  discard-paths: no
